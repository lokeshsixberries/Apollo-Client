{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { useCallback, useMemo, useRef } from 'react';\nimport { ApolloError } from \"../../errors/index.js\";\nimport { useInternalState } from \"./useQuery.js\";\nimport { useApolloClient } from \"./useApolloClient.js\";\nimport { isNonEmptyArray } from \"../../utilities/index.js\";\nvar EAGER_METHODS = ['refetch', 'reobserve', 'fetchMore', 'updateQuery', 'startPolling', 'subscribeToMore'];\nexport function useLazyQuery(query, options) {\n  var internalState = useInternalState(useApolloClient(options && options.client), query);\n  var execOptionsRef = useRef();\n  var defaultOptions = internalState.client.defaultOptions.watchQuery;\n  var initialFetchPolicy = options && options.fetchPolicy || execOptionsRef.current && execOptionsRef.current.fetchPolicy || defaultOptions && defaultOptions.fetchPolicy || \"cache-first\";\n  var useQueryResult = internalState.useQuery(__assign(__assign(__assign({}, options), execOptionsRef.current), {\n    skip: !execOptionsRef.current\n  }));\n  var result = Object.assign(useQueryResult, {\n    called: !!execOptionsRef.current\n  });\n  var eagerMethods = useMemo(function () {\n    var eagerMethods = {};\n\n    var _loop_1 = function (key) {\n      var method = result[key];\n\n      eagerMethods[key] = function () {\n        if (!execOptionsRef.current) {\n          execOptionsRef.current = Object.create(null);\n          internalState.forceUpdate();\n        }\n\n        return method.apply(this, arguments);\n      };\n    };\n\n    for (var _i = 0, EAGER_METHODS_1 = EAGER_METHODS; _i < EAGER_METHODS_1.length; _i++) {\n      var key = EAGER_METHODS_1[_i];\n\n      _loop_1(key);\n    }\n\n    return eagerMethods;\n  }, []);\n  Object.assign(result, eagerMethods);\n  var execute = useCallback(function (executeOptions) {\n    var promise = result.reobserve(execOptionsRef.current = executeOptions ? __assign(__assign({}, executeOptions), {\n      fetchPolicy: executeOptions.fetchPolicy || initialFetchPolicy\n    }) : {\n      fetchPolicy: initialFetchPolicy\n    }).then(function (apolloQueryResult) {\n      apolloQueryResult = apolloQueryResult || internalState[\"getCurrentResult\"]();\n\n      if (apolloQueryResult.error || isNonEmptyArray(apolloQueryResult.errors)) {\n        var _a = result.observable.options.errorPolicy,\n            errorPolicy = _a === void 0 ? \"none\" : _a;\n\n        if (errorPolicy === \"none\") {\n          throw apolloQueryResult.error || new ApolloError({\n            graphQLErrors: apolloQueryResult.errors\n          });\n        }\n      }\n\n      return internalState.toQueryResult(apolloQueryResult);\n    }).then(function (queryResult) {\n      return Object.assign(queryResult, eagerMethods);\n    });\n    internalState.forceUpdate();\n    promise.catch(function () {});\n    return promise;\n  }, []);\n  return [execute, result];\n}","map":{"version":3,"mappings":"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","names":["useCallback","useMemo","useRef","ApolloError","useInternalState","useApolloClient","isNonEmptyArray","EAGER_METHODS","useLazyQuery","query","options","internalState","client","execOptionsRef","defaultOptions","watchQuery","initialFetchPolicy","fetchPolicy","current","useQueryResult","useQuery","__assign","skip","result","Object","assign","called","eagerMethods","key","method","create","forceUpdate","apply","arguments","_i","execute","promise","reobserve","executeOptions","then","apolloQueryResult","error","errors","observable","errorPolicy","_a","graphQLErrors","toQueryResult","queryResult","catch"],"sources":["/home/hp/apolloclient/node_modules/@apollo/src/react/hooks/useLazyQuery.ts"],"sourcesContent":["import { DocumentNode } from 'graphql';\nimport { TypedDocumentNode } from '@graphql-typed-document-node/core';\nimport { useCallback, useMemo, useRef } from 'react';\n\nimport { OperationVariables } from '../../core';\nimport { ApolloError } from '../../errors';\nimport {\n  LazyQueryHookOptions,\n  LazyQueryResultTuple,\n  QueryResult,\n} from '../types/types';\nimport { useInternalState } from './useQuery';\nimport { useApolloClient } from './useApolloClient';\nimport { isNonEmptyArray } from '../../utilities';\n\n// The following methods, when called will execute the query, regardless of\n// whether the useLazyQuery execute function was called before.\nconst EAGER_METHODS = [\n  'refetch',\n  'reobserve',\n  'fetchMore',\n  'updateQuery',\n  'startPolling',\n  'subscribeToMore',\n] as const;\n\nexport function useLazyQuery<TData = any, TVariables = OperationVariables>(\n  query: DocumentNode | TypedDocumentNode<TData, TVariables>,\n  options?: LazyQueryHookOptions<TData, TVariables>\n): LazyQueryResultTuple<TData, TVariables> {\n  const internalState = useInternalState(\n    useApolloClient(options && options.client),\n    query,\n  );\n\n  const execOptionsRef = useRef<Partial<LazyQueryHookOptions<TData, TVariables>>>();\n  const defaultOptions = internalState.client.defaultOptions.watchQuery;\n  const initialFetchPolicy =\n    (options && options.fetchPolicy) ||\n    (execOptionsRef.current && execOptionsRef.current.fetchPolicy) ||\n    (defaultOptions && defaultOptions.fetchPolicy) ||\n    \"cache-first\";\n\n  const useQueryResult = internalState.useQuery({\n    ...options,\n    ...execOptionsRef.current,\n    skip: !execOptionsRef.current,\n  });\n\n  const result: QueryResult<TData, TVariables> =\n    Object.assign(useQueryResult, {\n      called: !!execOptionsRef.current,\n    });\n\n  // We use useMemo here to make sure the eager methods have a stable identity.\n  const eagerMethods = useMemo(() => {\n    const eagerMethods: Record<string, any> = {};\n    for (const key of EAGER_METHODS) {\n      const method = result[key];\n      eagerMethods[key] = function () {\n        if (!execOptionsRef.current) {\n          execOptionsRef.current = Object.create(null);\n          // Only the first time populating execOptionsRef.current matters here.\n          internalState.forceUpdate();\n        }\n        return method.apply(this, arguments);\n      };\n    }\n\n    return eagerMethods;\n  }, []);\n\n  Object.assign(result, eagerMethods);\n\n  const execute = useCallback<\n    LazyQueryResultTuple<TData, TVariables>[0]\n  >(executeOptions => {\n    const promise = result.reobserve(\n      execOptionsRef.current = executeOptions ? {\n        ...executeOptions,\n        fetchPolicy: executeOptions.fetchPolicy || initialFetchPolicy,\n      } : {\n        fetchPolicy: initialFetchPolicy,\n      },\n    ).then(apolloQueryResult => {\n      // If this.observable.options.fetchPolicy is \"standby\", the\n      // apolloQueryResult we receive here can be undefined, so we call\n      // getCurrentResult to obtain a stub result.\n      // TODO Investigate whether standby queries could return this stub result\n      // in the first place.\n      apolloQueryResult = apolloQueryResult || internalState[\"getCurrentResult\"]();\n\n      if (\n        apolloQueryResult.error ||\n        isNonEmptyArray(apolloQueryResult.errors)\n      ) {\n        const {\n          errorPolicy = \"none\",\n        } = result.observable.options;\n\n        if (errorPolicy === \"none\") {\n          throw apolloQueryResult.error || new ApolloError({\n            graphQLErrors: apolloQueryResult.errors,\n          });\n        }\n      }\n\n      return internalState.toQueryResult(apolloQueryResult);\n\n    }).then(queryResult => Object.assign(queryResult, eagerMethods));\n\n    // Deliver the loading state for this reobservation immediately.\n    internalState.forceUpdate();\n\n    // Because the return value of `useLazyQuery` is usually floated, we need\n    // to catch the promise to prevent unhandled rejections.\n    promise.catch(() => {});\n\n    return promise;\n  }, []);\n\n  return [execute, result];\n}\n"]},"metadata":{},"sourceType":"module"}